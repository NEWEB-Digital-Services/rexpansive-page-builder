var Rexbuilder_Util=function($){"use strict";var $window=$(window),fixSectionWidth=0,editorMode=!1,windowIsResizing=!1,responsiveLayouts,defaultLayoutSections,createRandomID=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},createSectionID=function(){var e,t,i=4;do t=!0,e=createRandomID(i),Rexbuilder_Util.$rexContainer.children(".rexpansive_section").each(function(){("self"==e||void 0!==$(this).attr("data-rexlive-section-id")&&$(this).attr("data-rexlive-section-id")==e)&&(t=!1)});while(!t);return e},createBlockID=function(){var e,t,i,a=4;do t=!0,e=createRandomID(a),Rexbuilder_Util.$rexContainer.find(".grid-stack-item").each(function(){i=$(this),("self"==e||void 0!==i.attr("data-rexbuilder-block-id")&&i.attr("data-rexbuilder-block-id")==e)&&(t=!1)});while(!t);return e},_updateSectionsID=function(){var e,t;Rexbuilder_Util.$rexContainer.children(".rexpansive_section").each(function(i,a){t=$(a),void 0===t.attr("data-rexlive-section-id")&&(e=createSectionID(),t.attr("data-rexlive-section-id",e))})},_updateSectionsNumber=function(){var e,t;Rexbuilder_Util.$rexContainer.children(".rexpansive_section").each(function(i,a){t=$(a),t.attr("data-rexlive-section-number",i),e=i}),Rexbuilder_Util.lastSectionNumber=e},chooseLayout=function(){var e=_viewport().width;console.log(e);var t=$("#rexbuilder-layout-data");if("true"==t.children(".layouts-data").data("empty-customizations")||Rexbuilder_Util.editorMode&&Rexbuilder_Util.firstStart)return"default";var i=JSON.parse(t.children(".available-layouts").text()),a="";console.log(i),$.each(i,function(e,t){""==t.min&&(t.min=0)});var o=lodash.sortBy(i,[function(e){return parseInt(e.min)}]);return $.each(o,function(t,i){e>=i.min&&(""!=i.max?e<i.max&&(a=i.id):a=i.id)}),""===a&&(a="default"),console.log(a),a},_edit_dom_layout=function(e){if(e!=Rexbuilder_Util.activeLayout){console.log("chosen: "+e),Rexbuilder_Util.$rexContainer.attr("data-rex-layout-selected",e);var t=$("#rexbuilder-layout-data");Rexbuilder_Util.activeLayout=e;var i={eventName:"rexlive:layoutChanged",activeLayoutName:e};if(Rexbuilder_Util_Editor.sendParentIframeMessage(i),"true"!=t.children(".layouts-customizations").data("empty-customizations")&&!t.children(".layouts-customizations").data("empty-customizations")){var a=JSON.parse(t.children(".layouts-customizations").text());responsiveLayouts=a,console.log(a),$.each(a,function(e,t){"default"==t.name&&(defaultLayoutSections=t.sections)});var o,r;for(r=0;r<a.length;r++)if(a[r].name==e){o=a[r];break}var n;r==a.length?(console.log("loading default layout"),n={}):n=o.sections,console.log("updaiting dom");var l,d,s,c,u,p,g,m,_=lodash.merge({},defaultLayoutSections,n);console.log(_),$.each(_,function(e,t){l=t.section_rex_id,c=Rexbuilder_Util.$rexContainer.children('section[data-rexlive-section-id="'+l+'"]'),u=c.find(".grid-stack-row");var i=u.data();if(void 0!==i){var a=u.data().plugin_perfectGridGalleryEditor;void 0!==a&&(a.batchGridstack(),console.log("enter batch mode"))}$.each(t.targets,function(e,t){if(d=t.name,s=t.props,"self"==d){console.log("setting section properties: "+d);var i=c.children(".section-data");_updateImageBG(c,isNaN(parseInt(s.id_image_bg_section))?"":parseInt(s.id_image_bg_section),s.image_bg_section,parseInt(s.image_width),parseInt(s.image_height),s.dimension),_updateVideos(i,c,s.video_bg_id,s.video_mp4_url,s.video_bg_url_vimeo_section,s.video_bg_url_section,"section",!1),_updateSectionMargins(c,s.row_margin_top,s.row_margin_bottom,s.row_margin_right,s.row_margin_left),_updateRow(i,u,s.block_distance,s.row_separator_top,s.row_separator_bottom,s.row_separator_right,s.row_separator_left,s.full_height,s.layout,s.section_width,s.collapseElements),c.css("background-color",s.color_bg_section)}else{console.log("setting el"),p=u.children('div[data-rexbuilder-block-id="'+d+'"]'),m=p.children(".rexbuilder-block-data"),g=p.find(".grid-item-content"),_updateVideos(m,g,s.video_bg_id,s.video_mp4_url,s.video_bg_url_vimeo,s.video_bg_url_youtube,"block","1"==s.video_has_audio),_updateImageBG(g,isNaN(parseInt(s.id_image_bg))?"":parseInt(s.id_image_bg),s.image_bg_url,parseInt(s.image_width),parseInt(s.image_height),s.type_bg_image);for(var a in s)switch(a){case"hide":break;case"type":m.attr("data-type",s[a]);break;case"size_x":p.attr("data-width",s[a]);break;case"size_y":p.attr("data-height",s[a]);break;case"row":p.attr("data-row",s[a]);break;case"col":p.attr("data-col",s[a]);break;case"gs_start_h":break;case"gs_width":p.attr("data-gs-width",s[a]);break;case"gs_height":p.attr("data-gs-height",s[a]);break;case"gs_y":p.attr("data-gs-y",s[a]);break;case"gs_x":p.attr("data-gs-x",s[a]);break;case"color_bg_block":g.css("background-color",s[a]);break;case"block_custom_class":p.removeClass(),p.addClass("perfect-grid-item grid-stack-item w"+parseInt(p.attr("data-gs-width"))),Rexbuilder_Util.editorMode&&p.addClass("rex-text-editable"),p.addClass(s[a]),m.attr("data-block_custom_class",s[a]);break;case"block_padding":var o=g.find(".text-wrap");if(0!=o.length){var r=s[a];r=r.replace(/;/g," "),r+=";",r=r.replace(/ ;/g,";"),r="padding: "+r,o.attr("style",r)}break;case"overlay_block_color":var n=p.find(".responsive-block-overlay");if(""!=s[a])if(0!=n.length)n.css("background-color",s[a]);else{tmpl.arg="overlay";var l=tmpl("tmpl-overlay-block-div",{color:s[a]});g.children().wrapAll(l)}else 0!=n.length&&n.children().eq(0).unwrap();m.attr("data-overlay_block_color",s[a]);break;case"photoswipe":Rexbuilder_Util.editorMode||("true"==s[a]?(addPhotoSwipeElement(g,s.image_bg_block,parseInt(s.image_width),parseInt(s.image_height),s.image_size),c.addClass("photoswipe-gallery")):removePhotoSwipeElement(g),m.attr("data-photoswipe",s[a]));break;case"linkurl":if(!Rexbuilder_Util.editorMode)if(""!=s[a])if(0!=g.parents(".element-link").length)console.log("already a link"),g.parents(".element-link").attr("href",s[a]),g.parents(".element-link").attr("title",s[a]);else{console.log("not a block link");var _=g.parent();tmpl.arg="link",_.append(tmpl("tmpl-link-block",{url:s[a]})),g.detach().appendTo();var h=_.children(".element-link");g.detach().appendTo(h)}else if(0!=g.parents(".element-link").length){var v=g.parents(".element-link");v.children().unwrap()}break;case"zak_background":break;case"zak_side":break;case"zak_title":break;case"zak_icon":break;case"zak_foreground":break;case"block_animation":break;case"block_has_scrollbar":break;case"block_live_edited":break;default:console.log("rip")}}}),void 0!==i&&void 0!==a&&(a.commitGridstack(),console.log("exit batch mode"))}),Rexbuilder_Util.editorMode||initPhotoSwipe(".photoswipe-gallery")}}},_updateRow=function(e,t,i,a,o,r,n,l,d,s,c){i=$.isEmptyObject(i)?20:parseInt(i),a=$.isEmptyObject(a)?i:parseInt(a),o=$.isEmptyObject(o)?i:parseInt(o),r=$.isEmptyObject(r)?i:parseInt(r),n=$.isEmptyObject(n)?i:parseInt(n),l=!$.isEmptyObject(l)&&l,d=$.isEmptyObject(d)?"fixed":d,s=$.isEmptyObject(s)?"100%":s,c=!$.isEmptyObject(c)&&c;var u={gutter:i,separatorTop:a,separatorBottom:o,separatorRight:r,separatorLeft:n,fullHeight:l,layout:d,collapseElements:c},p=t.parent();"100%"==s?(p.removeClass("center-disposition"),p.addClass("full-disposition"),p.css("max-width",s)):(p.removeClass("full-disposition"),p.addClass("center-disposition"),p.css("max-width",s));var g=t.data();if(void 0!==g){var m=t.data().plugin_perfectGridGalleryEditor;void 0!==m&&m.updateGridSettings(u)}t.attr("data-separator",i),t.attr("data-row-separator-top",a),t.attr("data-row-separator-right",r),t.attr("data-row-separator-bottom",o),t.attr("data-row-separator-left",n),t.attr("data-layout",d),t.attr("data-full-height",l),e.attr("data-section_width",s.replace(/%/,"")),e.attr("data-responsive_collapse",c)},_updateSectionMargins=function(e,t,i,a,o){var r="";r+=$.isEmptyObject(t)?0:t,r+="px ",r+=$.isEmptyObject(i)?0:i,r+="px ",r+=$.isEmptyObject(a)?0:a,r+="px ",r+=$.isEmptyObject(o)?0:o,r+="px",e.css("margin",r)},_updateImageBG=function(e,t,i,a,o,r){if(console.log("setting bgImage"),e.hasClass("rexpansive_section"))var n=e.children("section-data"),l="section";else{if(!e.hasClass("grid-item-content"))return;var n=e.parents(".grid-stack-item").children("rexbuilder-block-data"),l="block"}if(""==t)n.attr("data-id_image_bg_"+l,""),e.attr("data-background_image_width",""),e.attr("data-background_image_height",""),e.css("background-image",""),e.removeClass("natural-image-background"),e.removeClass("full-image-background"),e.removeClass("small-width"),n.data("image_bg_"+l,""),n.data("id_image_bg_"+l,""),n.data("type_bg_"+l,""),n.data("image_size","");else{if(t==parseInt(n.data("id_image_bg"+l)))return;e.attr("style","background-image: url('"+i+"'); background-color: rgba(0, 0, 0, 0);"),e.attr("data-background_image_width",a),e.attr("data-background_image_height",o),n.attr("data-id_image_bg_"+l,t),n.attr("data-type_bg_"+l,r),"full"==r?(e.addClass("full-image-background"),e.removeClass("natural-image-background")):(e.addClass("natural-image-background"),e.removeClass("full-image-background")),n.attr("data-image_size",r)}},addPhotoSwipeElement=function(e,t,i,a,o){tmpl.arg="image";var r=e.parents(".grid-stack-item-content");if(console.log("checking if is already photoswipe"),0==e.parents(".pswp-figure").length){console.log("not"),e.parent().prepend(tmpl("tmpl-photoswipe-block",{link:t,width:i,height:a,type:o}));var n=r.find(".pswp-item");e.detach().appendTo(n)}},removePhotoSwipeElement=function(e){console.log("removing photoswipe"),console.log(e);var t=e.parents(".pswp-figure");if(console.log(t),0!=t.length){console.log("removing ps");var i=t.parent();e.detach().appendTo(i),t.remove()}},initPhotoSwipe=function(e){for(var t=function(e){for(var t,i,a,o,r=$(e).find(".pswp-figure").get(),n=r.length,l=[],d=0;d<n;d++)t=r[d],1===t.nodeType&&(i=t.children[0],a=i.getAttribute("data-size").split("x"),o={src:i.getAttribute("href"),w:parseInt(a[0],10),h:parseInt(a[1],10)},t.children.length>1&&(o.title=t.children[1].innerHTML),i.children.length>0&&(o.msrc=i.children[0].getAttribute("data-thumburl")),o.el=t,l.push(o));return l},i=function c(e,t){return e&&(t(e)?e:c(e.parentNode,t))},a=function(t){if(t=t||window.event,!($(t.target).parents(".perfect-grid-item").find(".element-link").length>0||$(t.target).is("a"))){t.preventDefault?t.preventDefault():t.returnValue=!1;var a=t.target||t.srcElement,o=i(a,function(e){return e.tagName&&"FIGURE"===e.tagName.toUpperCase()});if(o){for(var n,l=$(o).parents(e)[0],d=$(l).find(".pswp-figure").get(),s=d.length,c=0,u=0;u<s;u++)if(1===d[u].nodeType){if(d[u]===o){n=c;break}c++}return n>=0&&r(n,l),!1}}},o=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;for(var i=e.split("&"),a=0;a<i.length;a++)if(i[a]){var o=i[a].split("=");o.length<2||(t[o[0]]=o[1])}return t.gid&&(t.gid=parseInt(t.gid,10)),t},r=function(e,i,a,o){var r,n,l,d=document.querySelectorAll(".pswp")[0];if(l=t(i),n={galleryUID:i.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(e){var t=l[e].el.getElementsByClassName("pswp-item-thumb")[0],i=l[e].el.getElementsByClassName("rex-custom-scrollbar")[0],a=window.pageYOffset||document.documentElement.scrollTop,o=i.getBoundingClientRect(),r=t.getAttribute("data-thumb-image-type");return"natural"==r?{x:o.left,y:o.top+a,w:o.width}:null},closeOnScroll:!1,showHideOpacity:!0},o)if(n.galleryPIDs){for(var s=0;s<l.length;s++)if(l[s].pid==e){n.index=s;break}}else n.index=parseInt(e,10)-1;else n.index=parseInt(e,10);isNaN(n.index)||(a&&(n.showAnimationDuration=0),r=new PhotoSwipe(d,PhotoSwipeUI_Default,l,n),r.init())},n=document.querySelectorAll(e),l=0,d=n.length;l<d;l++)n[l].setAttribute("data-pswp-uid",l+1),n[l].onclick=a;var s=o();s.pid&&s.gid&&r(s.pid,n[s.gid-1],!0,!0)},_updateVideos=function(e,t,i,a,o,r,n,l){console.log("data received"),console.log(i,a,o,r,n,l),$.isEmptyObject(a)&&$.isEmptyObject(r)&&$.isEmptyObject(o)&&(removeMp4Video(t,n),removeYoutubeVideo(t,n),removeVimeoVideo(t,n)),!$.isEmptyObject(a)&&$.isEmptyObject(r)&&$.isEmptyObject(o)&&(console.log("updating videos mp4"),removeYoutubeVideo(t,n),removeVimeoVideo(t,n),addMp4Video(t,a,n,l)),$.isEmptyObject(a)&&!$.isEmptyObject(r)&&$.isEmptyObject(o)&&(console.log("updating videos youtube"),removeMp4Video(t,n),removeVimeoVideo(t,n),addYoutubeVideo(t,r,n,l)),$.isEmptyObject(a)&&$.isEmptyObject(r)&&!$.isEmptyObject(o)&&(removeMp4Video(t,n),removeYoutubeVideo(t,n),addVimeoVideo(t,o,n,l)),"section"==n?(e.attr("data-video_bg_id_section",i),e.attr("data-video_mp4_url",a),e.attr("data-video_bg_url_section",r),e.attr("data-video_bg_url_vimeo_section",o)):(e.attr("data-video_bg_id",i),e.attr("data-video_mp4_url",a),e.attr("data-video_bg_url",r),e.attr("data-video_bg_url_vimeo",o))},removeMp4Video=function(e,t){if("section"==t)var i=e.children(".rex-video-section-wrap");else{if("block"!=t)return;var i=e.children(".rex-video-wrap"),a=e.children(".rex-video-toggle-audio")}0!=i.length&&(console.log("removing mp4 video"),e.removeClass("mp4-player"),i.remove(),"section"!=t&&0!=a.length&&a.remove())},removeYoutubeVideo=function(e,t){if(e.hasClass("youtube-player")){e.YTPPlayerDestroy();var i=e.children(".mbYTP_wrapper");if(i.remove(),e.removeAttr("data-property"),e.removeClass("youtube-player mb_YTPlayer isMuted"),"section"!=t){var a=e.children(".rex-video-toggle-audio");0!=a.length&&a.remove()}}},removeVimeoVideo=function(e,t){var i=e.children(".rex-video-vimeo-wrap"),a=e.children(".rex-video-toggle-audio");if(0!=i.length){var o=i.children("iframe")[0];VimeoVideo.removePlayer(o),e.removeClass("vimeo-player"),i.remove(),0!=a.length&&a.remove()}},addMp4Video=function(e,t,i,a){if("section"==i)var o=e.children(".rex-video-section-wrap");else{if("block"!=i)return;var o=e.children(".rex-video-wrap")}if(0==o.length||o.find("source").attr("src")!=t)removeMp4Video(e),tmpl.arg="video",e.prepend(tmpl("tmpl-video-mp4",{url:t})),a&&e.append(tmpl("tmpl-video-toggle-audio")),e.addClass("mp4-player");else if("section"!=i){var r=e.children(".rex-video-toggle-audio");0==r.length?a&&e.append(tmpl("tmpl-video-toggle-audio")):a||r.remove()}},addYoutubeVideo=function(e,t,i,a){if("section"!=i){var o=e.children(".rex-video-toggle-audio");0==o.length?a&&e.append(tmpl("tmpl-video-toggle-audio")):a||o.remove()}if(e.hasClass("youtube-player")){if(void 0===e.YTPGetPlayer())return e.YTPlayer(),void console.log(e[0]);var r=e.YTPGetVideoID(),n=getYoutubeID(t);r!=n&&e.YTPChangeMovie({videoURL:t,containment:"self",startAt:0,mute:!0,autoPlay:!0,loop:!0,opacity:1,showControls:!1,showYTLogo:!1})}else e.addClass("youtube-player"),e.attr("data-property","{videoURL: '"+t+"', containment: 'self',startAt: 0,mute: true,autoPlay: true,loop: true,opacity: 1,showControls: false,showYTLogo: false}"),e.YTPlayer()},addVimeoVideo=function(e,t,i,a){var o=e.children(".rex-video-vimeo-wrap");if(t+="?autoplay=1&loop=1&title=0&byline=0&portrait=0&autopause=0&muted=1",0==o.length||o.children("iframe").attr("src")!=t){removeVimeoVideo(e,i),tmpl.arg="video",e.prepend(tmpl("tmpl-video-vimeo",{url:t})),a&&e.append(tmpl("tmpl-video-toggle-audio")),e.addClass("vimeo-player");var r=e.children(".rex-video-vimeo-wrap").find("iframe")[0];VimeoVideo.addPlayer("1",r)}else if("section"!=i){var n=e.children(".rex-video-toggle-audio");0==n.length?a&&e.append(tmpl("tmpl-video-toggle-audio")):a||n.remove()}},_detect_mobile=function(){"ontouchstart"in document.documentElement?document.documentElement.className+=" touch":document.documentElement.className+=" no-touch"},_viewport=function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},getYoutubeID=function(e){var t;return t=e.indexOf("youtu.be")>0?e.substr(e.lastIndexOf("/")+1,e.length):e.indexOf("http")>-1?e.match(/[\\?&]v=([^&#]*)/)[1]:e.length>15?null:e},_getQueryVariable=function(e){for(var t=window.location.search.substring(1),i=t.split("&"),a=0;a<i.length;a++){var o=i[a].split("=");if(o[0]==e)return o[1]}return!1},_checkPresentationPage=function(){return 0!==$(".rexpansive_portfolio_presentation").length},_checkStaticPresentationPage=function(){return 0!==$(".rexpansive-static-portfolio").length},_checkPost=function(){return 0!==$("#rex-article").length},_whichTransitionEvent=function(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]},_whichAnimationEvent=function(){var e,t=document.createElement("fakeelement"),i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in i)if(void 0!==t.style[e])return i[e]},addWindowListeners=function(){function e(){console.log("window resized"),Rexbuilder_Util.windowIsResizing=!0,Rexbuilder_Util.editorMode&&!Rexbuilder_Util_Editor.buttonResized||(Rexbuilder_Util.editorMode?(Rexbuilder_Util_Editor.buttonResized=!1,_edit_dom_layout(Rexbuilder_Util_Editor.clickedLayoutID)):_edit_dom_layout(chooseLayout()),Rexbuilder_Util.$rexContainer.find(".grid-stack-row").each(function(){var e=$(this).data().plugin_perfectGridGalleryEditor;void 0!==e&&(e._defineDynamicPrivateProperties(),e.updateBlocksHeight(),"fixed"==e.settings.galleryLayout&&e.updateGridstackFixedMode(),e=void 0)}),Rexbuilder_Util.$rexContainer.find(".grid-stack-row").each(function(){var e=$(this).data().plugin_perfectGridGalleryEditor;void 0!==e&&e.createScrollbars()}),Rexbuilder_Util.windowIsResizing=!1,i=!0)}var t,i=!0;Rexbuilder_Util.$window.on("resize",function(a){Rexbuilder_Util_Editor.elementIsResizing||(a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation(),Rexbuilder_Util.windowIsResizing=!0,i&&(Rexbuilder_Util.$rexContainer.find(".grid-stack-row").each(function(){var e=$(this).data().plugin_perfectGridGalleryEditor;void 0!==e&&e.removeScrollbars()}),i=!1),clearTimeout(t),t=setTimeout(e,1e3))})},_destroyVideoPlugins=function(){console.log(Rexbuilder_Util.$rexContainer.find(".youtube-player"))},_launchVideoPlugins=function(){jQuery.browser.mobile?Rexbuilder_Util.$rexContainer.find(".youtube-player").each(function(i,el){var $this=$(el),data_yt=eval("("+$this.attr("data-property")+")"),url=data_yt.videoURL,id=getYoutubeID(url);$this.css("background-image","url(http://img.youtube.com/vi/"+id+"/0.jpg)"),$this.click(function(e){e.preventDefault(),window.location.href=url})}):Rexbuilder_Util.$rexContainer.find(".youtube-player").each(function(){if(void 0===$(this).YTPGetPlayer())return $(this).YTPlayer(),void console.log(this)}),RexSlider.init(),VimeoVideo.init()},setContainer=function(e){this.$rexContainer=e},_has_class=function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},_transitionEvent="",_animationEvent="",_scroll_timing=600,init=function(){this.firstStart=!0,_plugin_frontend_settings.user.logged&&_plugin_frontend_settings.user.editing?this.editorMode=!0:this.editorMode=!1,this.$window=$(window),this.$body=$("body"),this.$rexContainer=$(".rex-container"),this.lastSectionNumber=-1,this.activeLayout="",_updateSectionsID();var e=chooseLayout();console.log(e),_edit_dom_layout(e),_updateSectionsNumber(),_detect_mobile(),this._transitionEvent=_whichTransitionEvent(),this._animationEvent=_whichAnimationEvent(),this.scrollbarProperties={className:"os-theme-dark",overflowBehavior:{x:"hidden"},autoUpdate:!1},this.firstStart=!1};return{init:init,viewport:_viewport,getYoutubeID:getYoutubeID,transitionEvent:_transitionEvent,animationEvent:_animationEvent,getQueryVariable:_getQueryVariable,checkPresentationPage:_checkPresentationPage,checkStaticPresentationPage:_checkStaticPresentationPage,checkPost:_checkPost,$window:$window,scroll_timing:_scroll_timing,fixSectionWidth:fixSectionWidth,editorMode:editorMode,windowIsResizing:windowIsResizing,addWindowListeners:addWindowListeners,launchVideoPlugins:_launchVideoPlugins,destroyVideoPlugins:_destroyVideoPlugins,chooseLayout:chooseLayout,setContainer:setContainer,createSectionID:createSectionID,createBlockID:createBlockID,has_class:_has_class,responsiveLayouts:responsiveLayouts,defaultLayoutSections:defaultLayoutSections,edit_dom_layout:_edit_dom_layout}}(jQuery);
var RexSlider=function(e){"use strict";var t=".rex-slider-wrap",i=".rex-slider-element",a=".flickity-page-dots.rex-slider__custom-nav",n=".rexpansive_section",r=".rex-box-slider-wrap",l=".rex-box-slider-element",s=function(){e(t,n).length&&e(t,n).each(function(t,n){var r=e(n),l={cellAlign:"left",prevNextButtons:!1,pageDots:!1,cellSelector:i,selectedAttraction:.018,friction:.3,wrapAround:!0,arrowShape:"M 71.080084,1.034481 C 71.763642,0.34482599 72.61809,-1.250001e-8 73.557983,-1.250001e-8 c 0.939893,0 1.794341,0.34482600250001 2.477899,1.03448101250001 1.367117,1.37931 1.367117,3.620689 0,5 L 32.459031,49.999998 76.035882,93.965515 c 1.367117,1.379311 1.367117,3.62069 0,5 -1.367117,1.379315 -3.588681,1.379315 -4.955798,0 L 25.025333,52.499998 c -1.367117,-1.37931 -1.367117,-3.62069 0,-5 l 46.054751,-46.465517 0,0 z"};l.setGallerySize="undefined"!=typeof r.attr("data-set-gallery-size")&&JSON.parse(r.attr("data-set-gallery-size"));var s=r.attr("data-rex-slider-animation");"undefined"!=typeof s&&"true"==s&&(l.autoPlay=!0);var d=r.attr("data-rex-slider-prev-next");"undefined"!=typeof d&&"1"==d&&(l.prevNextButtons=!0);var o=r.attr("data-rex-slider-dots");"undefined"!=typeof o&&"1"==o&&(l.pageDots=!0),r.hasClass("rex-slider--bottom-interface")&&r.parents(".block-has-slider").addClass("block-has-slider--navigator"),r.flickity(l),r.flickity("stopPlayer"),Rexbuilder_Util.$window.on("resize",function(){r.data("flickity")&&r.flickity("resize")}),r.on("dragStart.flickity",function(){e(this).addClass("is-dragging")}),r.on("dragEnd.flickity",function(){e(this).removeClass("is-dragging")}),r.on("select.flickity",function(){var t=e(this).find(".rex-slider-element.is-selected .youtube-player");if(t.length){var i=t[0].state;1!=i&&t.YTPPlay()}}),r.find(a).children().first().addClass("is-selected"),r.find(a).on("click",".dot",function(t){var i=e(this),a=i.index();i.addClass("is-selected").siblings(".dot").removeClass("is-selected"),r.flickity("select",a)})}),e(r,n).length&&e(r,n).each(function(t,i){var a={cellAlign:"center",prevNextButtons:!0,pageDots:!0,cellSelector:l,selectedAttraction:.018,friction:.3,initialIndex:"undefined"!=typeof e(i).attr("data-rex-box-slider-initialIndex")?parseInt(e(i).attr("data-rex-box-slider-initialIndex")):0,setGallerySize:!1,arrowShape:"m 38.79662,40.087413 0,0 c -0.387529,0 -0.757576,-0.154429 -1.031468,-0.425408 L 1.2470862,3.1322842 c -0.56818177,-0.5681815 -0.56818177,-1.4918411 0,-2.060023 0.5681819,-0.56818197 1.4918415,-0.56818197 2.0600234,0 L 38.793706,36.570513 74.294872,1.0722612 c 0.568182,-0.56818197 1.491842,-0.56818197 2.060023,0 0.568182,0.5681819 0.568182,1.4918415 0,2.060023 L 39.825175,39.659091 c -0.273893,0.273893 -0.641026,0.428322 -1.028555,0.428322 l 0,0 0,0 z"},n=e(i).attr("data-rex-slider-animation");"undefined"!=typeof n&&"true"==n&&(a.autoPlay=!0),e(i).flickity(a),e(i).flickity("stopPlayer"),Rexbuilder_Util.$window.on("resize",function(){e(i).flickity("resize")}),e(i).on("dragStart.flickity",function(){e(this).addClass("is-dragging")}),e(i).on("dragEnd.flickity",function(){e(this).removeClass("is-dragging")})})},d=function(){e(t,n).length&&e(t,n).each(function(t,i){"undefined"!=typeof e(i).data("flickity")&&e(i).flickity("destroy")}),e(r,n).length&&e(r,n).each(function(t,i){"undefined"!=typeof e(i).data("flickity")&&e(i).flickity("destroy")})},o=function(){s()},c=function(){e(t,n).length&&e(t,n).each(function(t,i){var a=e(i).attr("data-rex-slider-animation");"undefined"!=typeof a&&"true"==a&&e(i).flickity("playPlayer")})};return{init:o,startAutoPlay:c,destroy:d}}(jQuery);
/**
 * JS object to fix CF7 forms if user wants some materialize style
 */
var Rexbuilder_FormFixes=function(e){"use strict";var c,n=function(){c=Rexbuilder_Util.$rexContainer.find(".wpcf7-form")},i=function(){c.each(function(c,n){var i=e(n);i.hasClass("rxcf7-custom-checkbox")&&(i.find(".wpcf7-checkbox").each(function(c,n){e(n).find("label").length>0&&e(n).find("input[type=checkbox]").after('<span class="rex-checkbox__indicator"></span>')}),i.find(".wpcf7-acceptance").each(function(c,n){e(n).find("label").length>0&&e(n).find("input[type=checkbox]").after('<span class="rex-checkbox__indicator"></span>')})),i.hasClass("rxcf7-custom-loader")&&i.find(".ajax-loader").append('<div class="sk-double-bounce"><div class="sk-child sk-double-bounce1"></div><div class="sk-child sk-double-bounce2"></div></div>')})},t=function(){document.addEventListener("wpcf7submit",function(c){var n=e(c.srcElement).parents(".perfect-grid-gallery");n.length>0&&setTimeout(function(){n.perfectGridGallery("refreshGrid")},200)},!1)},a=function(){n(),t(),i()};return{init:a}}(jQuery);
var VimeoVideo=function(e){"use strict";var i=null,o=null,n=function(){i=Rexbuilder_Util.$rexContainer.find(".rex-video-vimeo-wrap--section"),o=Rexbuilder_Util.$rexContainer.find(".rex-video-vimeo-wrap--block")},t=function(){i.length>0&&i.each(function(i,o){var n=e(o).find("iframe")[0];if("undefined"!=typeof Vimeo){var t=new Vimeo.Player(n);t.ready().then(function(){t.setVolume(0)})}})},r=function(i){var n=i;o.length>0&&o.each(function(i,o){var t=e(o).attr("data-vimeo-video-mute"),r=e(o).find("iframe")[0];"undefined"!=typeof Vimeo&&n.addPlayer(t,r)})},l=function(e,i){var o=new Vimeo.Player(i);"1"==e&&o.ready().then(function(){o.setVolume(0)});var n={el:i,player:o};this.blockVideos.push(n)},a=function(e){for(var i=0;i<this.blockVideos.length;i++)if(this.blockVideos[i].el===e)return this.blockVideos[i].player;return null},d=function(e){var i,o=!1;for(i=0;i<this.blockVideos.length;i++)if(this.blockVideos[i].el===e){this.blockVideos[i].player.destroy().then(function(){console.log("player destroyed")})["catch"](function(e){console.log(e)}),o=!0;break}o&&this.blockVideos.splice(i,1)},c=function(){this.blockVideos=[],n(),t(),r(this)};return{init:c,findVideo:a,initBlockVideos:r,addPlayer:l,removePlayer:d}}(jQuery);
var lodash=_.noConflict(),Rexbuilder_App=function(e){"use strict";var t=null,i=null,n=function(){function n(){t.each(function(){var t=e(this);if("undefined"!=typeof t.attr("id")&&""!=t.attr("id")){var i=Rexbuilder_Util.$rexContainer.find('.vertical-nav a[href="#'+t.attr("id")+'"]').data("number")-1;t.offset().top-Rexbuilder_Util.$window.height()/2<Rexbuilder_Util.$window.scrollTop()&&t.offset().top+t.height()-Rexbuilder_Util.$window.height()/2>Rexbuilder_Util.$window.scrollTop()?s.eq(i).addClass("is-selected"):s.eq(i).removeClass("is-selected")}})}function r(t){e("body,html").animate({scrollTop:t.offset().top+_plugin_frontend_settings.scroll_animation_offset},600)}if(Rexbuilder_Util.init(),Rexbuilder_Util.editorMode&&(Rexbuilder_Util_Editor.init(),Rexbuilder_Section.init()),Rexbuilder_Util.editorMode&&(Rexbuilder_Util_Editor.addBlockToolboxListeners(),Rexbuilder_Util_Editor.addDocumentListeners(),Rexbuilder_Util_Editor.addWindowListeners()),Rexbuilder_Util.addWindowListeners(),t=Rexbuilder_Util.$rexContainer.find(".rexpansive_section"),i=Rexbuilder_Util.$rexContainer.find(".grid-stack-row"),i.perfectGridGalleryEditor(),Rexbuilder_Util.editorMode||(t.each(function(t,i){var n=i.getElementsByClassName("pswp-figure");0===n.length&&e(i).removeClass("photoswipe-gallery")}),l(".photoswipe-gallery")),Rexbuilder_Util.launchVideoPlugins(),e(document).on("click",".perfect-grid-item",function(){if(!e(this).hasClass("block-has-slider")){var t=e(this).find(".youtube-player"),i=e(this).find(".rex-video-container");if(t.length>0){var n=t[0].state;1==n?t.YTPPause():t.YTPPlay()}i.length>0&&(i.get(0).paused?i.get(0).play():i.get(0).pause())}}),e(document).on("click",".rex-video-toggle-audio",function(t){console.log("click on toggle"),t.stopPropagation();var i=e(this).parents(".youtube-player"),n=e(this).parents(".mp4-player").find(".rex-video-container"),r=e(this).parents(".vimeo-player").find(".rex-video-vimeo-wrap--block"),l=e(this);if(i.length>0){var o=i.get(0).player.isMuted();o?(i.YTPUnmute(),e(this).removeClass("user-has-muted")):(i.YTPMute(),e(this).addClass("user-has-muted"))}if(n.length>0&&(n.prop("muted")?(n.prop("muted",!1),e(this).removeClass("user-has-muted")):(n.prop("muted",!0),e(this).addClass("user-has-muted"))),r.length>0){var a=VimeoVideo.findVideo(r.find("iframe")[0]);a&&a.getVolume().then(function(e){0==e?(a.setVolume(1),l.removeClass("user-has-muted")):(a.setVolume(0),l.addClass("user-has-muted"))})["catch"](function(e){})}}),1==_plugin_frontend_settings.native_scroll_animation){for(var o=['[href="#"]',".no-smoothing",".vertical-nav-link",".rex-vertical-nav-link",".woocommerce-review-link"],a=Rexbuilder_Util.$body.find('a[href*="#"]'),d=0;d<o.length;d++)a=a.not(o[d]);a=a.not(c),a.click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=e(this.hash);if(t=t.length?t:Rexbuilder_Util.$rexContainer.find("[name="+this.hash.slice(1)+"]"),t.length)return r(t),!1}})}var s=Rexbuilder_Util.$rexContainer.find(".vertical-nav a");n(),Rexbuilder_Util.$window.on("scroll",function(){n()}),s.on("click",function(t){t.preventDefault(),r(e(this.hash))}),Rexbuilder_Util.$rexContainer.find(".touch .rex-nav-trigger").on("click",function(){Rexbuilder_Util.$rexContainer.find(".touch .vertical-nav").toggleClass("open")});var u=Rexbuilder_Util.$rexContainer.find(".touch .vertical-nav a");u.on("click",function(){u.find(".rex-label").removeClass("fadeInAndOut"),e(this).find(".rex-label").addClass("fadeInAndOut"),Rexbuilder_Util.$rexContainer.find(".touch .vertical-nav").removeClass("open")});var c=function(t){return 0!=e(this).parents(".woocommerce-tabs").length}},r=function(){var n=e(".text-fill-container-canvas");n.length>0&&(n.textFill({relative:!0,relativeWrap:".perfect-grid-item",fontFamily:_plugin_frontend_settings.textFill.font_family,fontWeight:_plugin_frontend_settings.textFill.font_weight}),n.on("textfill-render-complete",function(){Rexbuilder_Util.$window.resize()})),RexSlider.startAutoPlay(),i.find(".rex-indicator__placeholder").rexIndicator(),t.rexScrolled({callback:function(t){if(Rexbuilder_Util.has_class(t,"rex-element--animated")){var i=e(t);i.addClass("run-animation").on(Rexbuilder_Util.transitionEvent,function(e){})}}}),"undefined"!=typeof _plugin_frontend_settings&&1==_plugin_frontend_settings.animations&&e(".rs-animation").rexScrollify({mobile:!1})},l=function(t){for(var i=function(t){for(var i,n,r,l,o=e(t).find(".pswp-figure").get(),a=o.length,d=[],s=0;s<a;s++)i=o[s],1===i.nodeType&&(n=i.children[0],r=n.getAttribute("data-size").split("x"),l={src:n.getAttribute("href"),w:parseInt(r[0],10),h:parseInt(r[1],10)},i.children.length>1&&(l.title=i.children[1].innerHTML),n.children.length>0&&(l.msrc=n.children[0].getAttribute("data-thumburl")),l.el=i,d.push(l));return d},n=function c(e,t){return e&&(t(e)?e:c(e.parentNode,t))},r=function(i){if(i=i||window.event,!(e(i.target).parents(".perfect-grid-item").find(".element-link").length>0||e(i.target).is("a"))){i.preventDefault?i.preventDefault():i.returnValue=!1;var r=i.target||i.srcElement,l=n(r,function(e){return e.tagName&&"FIGURE"===e.tagName.toUpperCase()});if(l){for(var a,d=e(l).parents(t)[0],s=e(d).find(".pswp-figure").get(),u=s.length,c=0,f=0;f<u;f++)if(1===s[f].nodeType){if(s[f]===l){a=c;break}c++}return a>=0&&o(a,d),!1}}},l=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;for(var i=e.split("&"),n=0;n<i.length;n++)if(i[n]){var r=i[n].split("=");r.length<2||(t[r[0]]=r[1])}return t.gid&&(t.gid=parseInt(t.gid,10)),t},o=function(e,t,n,r){var l,o,a,d=document.querySelectorAll(".pswp")[0];if(a=i(t),o={galleryUID:t.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(e){var t=a[e].el.getElementsByClassName("pswp-item-thumb")[0],i=a[e].el.getElementsByClassName("rex-custom-scrollbar")[0],n=window.pageYOffset||document.documentElement.scrollTop,r=i.getBoundingClientRect(),l=t.getAttribute("data-thumb-image-type");return"natural"==l?{x:r.left,y:r.top+n,w:r.width}:null},closeOnScroll:!1,showHideOpacity:!0},r)if(o.galleryPIDs){for(var s=0;s<a.length;s++)if(a[s].pid==e){o.index=s;break}}else o.index=parseInt(e,10)-1;else o.index=parseInt(e,10);isNaN(o.index)||(n&&(o.showAnimationDuration=0),l=new PhotoSwipe(d,PhotoSwipeUI_Default,a,o),l.init())},a=document.querySelectorAll(t),d=0,s=a.length;d<s;d++)a[d].setAttribute("data-pswp-uid",d+1),a[d].onclick=r;var u=l();u.pid&&u.gid&&o(u.pid,a[u.gid-1],!0,!0)};return{init:n,load:r}}(jQuery);!function(e){"use strict";e(function(){Rexbuilder_App.init()}),e(window).load(function(){Rexbuilder_App.load()})}(jQuery);