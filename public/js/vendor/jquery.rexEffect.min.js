/*
 *  rexEffect
 *  @version 1.0.0
 *
 *  Made by NEWEB - Digital Agency
 */
!function(n,f,i,e){"use strict";var r="rexEffect",s={block_parent:".perfect-grid-item",effect:{name:"",options:{}}};function o(e,t){this.element=e,this.$element=n(e),this.settings=n.extend({},s,t),this._defaults=s,this._name=r,this.$window=n(f),this.settings.animationClasses={fadeIn:"fadeIn",fadeOut:"fadeOut"},this.init()}n.extend(o.prototype,{init:function(){this.initEffect(),this.runEffect()},initEffect:function(){switch(this.settings.effect.name){case"distortion":var e=[],t=(n=this.element.getElementsByClassName("grid-item-content")[0]).getBoundingClientRect(),i=this.element.children[0],s=(e.push(i.getAttribute("data-image_bg_block")),i.getAttribute("data-block_flex_img_position").split(" ")),r=i.getAttribute("data-type_bg_block");this.settings.effect.settings={stageWidth:t.width,stageHeight:t.height,sprites:e,spritePosition:s,spriteDimension:r,displacementImage:_plugin_frontend_settings.plugin_base_url+"public/img/clouds.jpg",autoPlay:!0,autoPlaySpeed:[10,3],displacementCenter:!0,displaceAutoFit:!1,appendTo:n},this.settings.effect.properties.viewHideContainer=!0,this.settings.effect.properties.$imageWrapper=this.$element.find(".rex-image-wrapper"),this.settings.effect.properties.alreadyVisible=!1,this.settings.effect.properties.launched=!1,this.settings.effect.properties.fadingIn=!1,this.settings.effect.properties.fadingOut=!1,this.settings.effect.properties.stopTimeout=3e3,this.settings.effect.properties.effectMode="scrollVisible",this.settings.effect.properties.canvasZIndex="-1";break;case"distortion-section":var n,e=[],t=(n=this.element).getBoundingClientRect(),i=this.element.children[0],s=(e.push(i.getAttribute("data-image_bg_section")),["center","middle"]),r=["full"];this.settings.effect.settings={stageWidth:t.width,stageHeight:t.height,sprites:e,spritePosition:s,spriteDimension:r,displacementImage:_plugin_frontend_settings.plugin_base_url+"public/img/clouds.jpg",autoPlay:!0,autoPlaySpeed:[10,3],displacementCenter:!0,displaceAutoFit:!1,appendTo:n},this.settings.effect.properties.viewHideContainer=!1,this.settings.effect.properties.$imageWrapper=this.$element,this.settings.effect.properties.alreadyVisible=!1,this.settings.effect.properties.launched=!1,this.settings.effect.properties.fadingIn=!1,this.settings.effect.properties.fadingOut=!1,this.settings.effect.properties.stopTimeout=3e3,this.settings.effect.properties.effectMode="scrollVisible",this.settings.effect.properties.canvasZIndex="0"}},runEffect:function(){switch(this.settings.effect.name){case"distortion":case"distortion-section":this.distortion()}},distortion:function(){var a=this;switch(this.settings.effect.properties.renderer=new PIXI.autoDetectRenderer(this.settings.effect.settings.stageWidth,this.settings.effect.settings.stageHeight,{transparent:!0}),this.settings.effect.properties.stage=new PIXI.Container,this.settings.effect.properties.effectContainer=new PIXI.Container,this.settings.effect.properties.displacementSprite=new PIXI.Sprite.fromImage(this.settings.effect.settings.displacementImage),this.settings.effect.properties.displacementFilter=new PIXI.filters.DisplacementFilter(this.settings.effect.properties.displacementSprite),!0===this.settings.effect.settings.displacementCenter&&(this.settings.effect.properties.displacementSprite.anchor.set(.5),this.settings.effect.properties.displacementSprite.x=this.settings.effect.properties.renderer.view.width/2,this.settings.effect.properties.displacementSprite.y=this.settings.effect.properties.renderer.view.height/2),this._launchDistortion(),f.addEventListener("resize",function(){a.settings.effect.properties.hasResized=!0}),f.addEventListener("scroll",function(){a.settings.effect.properties.hasScrolled=!0}),setInterval(function(){if(a.settings.effect.properties.hasResized){var e,t,i=a.settings.effect.settings.appendTo.getBoundingClientRect(),s=(a.settings.effect.properties.renderer.resize(i.width,i.height),a.settings.effect.properties.effectContainer.getChildAt(0)),i=s.texture.orig.width,r=s.texture.orig.height,n=a.settings.effect.properties.renderer.width,f=a.settings.effect.properties.renderer.height,o=r/i,p=f/n;switch("natural"===a.settings.effect.settings.spriteDimension?o<p?t=(e=n)*o:e=(t=f)/o:o<p?e=(t=f)/o:t=(e=n)*o,s.transform.scale.x=e/i,s.transform.scale.y=t/r,a.settings.effect.settings.spritePosition[0]){case"left":s.x=0;break;case"right":s.x=a.settings.effect.properties.renderer.width-e;break;default:s.x=(a.settings.effect.properties.renderer.width-e)/2}switch(a.settings.effect.settings.spritePosition[1]){case"top":s.y=0;break;case"bottom":s.y=a.settings.effect.properties.renderer.height-t;break;default:s.y=(a.settings.effect.properties.renderer.height-t)/2}a.settings.effect.properties.hasResized=!1}},250),this.settings.effect.properties.effectMode){case"oneTime":setInterval(function(){a.settings.effect.properties.hasScrolled&&!a.settings.effect.properties.launched&&(a.isVisibile()?a.settings.effect.properties.ticker.started||(a._fadeInDistortion(),a._timeoutDistortionTicker(),a.settings.effect.properties.launched=!0,a.settings.effect.properties.alreadyVisible=!0):(a.settings.effect.properties.ticker.started&&a._fadeOutDistortion(),a.settings.effect.properties.alreadyVisible=!1)),a.settings.effect.properties.hasScrolled=!1},250);break;case"scrollAll":setInterval(function(){a.settings.effect.properties.hasScrolled&&(a.isVisibile()?a.settings.effect.properties.ticker.started||(a._fadeInDistortion(),a._timeoutDistortionTicker(),a.settings.effect.properties.launched=!0,a.settings.effect.properties.alreadyVisible=!0):(a.settings.effect.properties.ticker.started&&a._fadeOutDistortion(),a.settings.effect.properties.alreadyVisible=!1)),a.settings.effect.properties.hasScrolled=!1},250);break;case"scrollVisible":setInterval(function(){a.settings.effect.properties.hasScrolled&&(a.isVisibile()?a.settings.effect.properties.ticker.started||a.settings.effect.properties.alreadyVisible||(a._fadeInDistortion(),a._timeoutDistortionTicker(),a.settings.effect.properties.launched=!0,a.settings.effect.properties.alreadyVisible=!0):(a.settings.effect.properties.ticker.started&&a._fadeOutDistortion(),a.settings.effect.properties.alreadyVisible=!1)),a.settings.effect.properties.hasScrolled=!1},250)}},_simpleFadeIn:function(){that.settings.effect.properties.ticker.start(),that.settings.effect.properties.renderer.view.style.opacity="1",that.settings.effect.properties.$imageWrapper[0].style.opacity="0"},_simpleFadeOut:function(){that.settings.effect.properties.ticker.stop(),that.settings.effect.properties.renderer.view.style.opacity="0",that.settings.effect.properties.$imageWrapper[0].style.opacity="1"},_fadeInDistortion:function(){var e;this.settings.effect.properties.fadingIn||((e=this).settings.effect.properties.fadingIn=!0,this.settings.effect.properties.ticker.start(),n(this.settings.effect.properties.renderer.view).addClass(this.settings.animationClasses.fadeIn).one("animationend",function(){e.settings.effect.properties.viewHideContainer&&(this.style.opacity="1"),n(this).removeClass(e.settings.animationClasses.fadeIn),e.settings.effect.properties.fadingIn=!1}),e.settings.effect.properties.viewHideContainer&&this.settings.effect.properties.$imageWrapper.addClass(this.settings.animationClasses.fadeOut).one("animationend",function(){this.style.opacity="0",n(this).removeClass(e.settings.animationClasses.fadeOut)}))},_fadeOutDistortion:function(){var e;this.settings.effect.properties.fadingOut||(this.settings.effect.properties.fadingOut=!0,n((e=this).settings.effect.properties.renderer.view).addClass(this.settings.animationClasses.fadeOut).one("animationend",function(){e.settings.effect.properties.viewHideContainer&&(this.style.opacity="0"),n(this).removeClass(e.settings.animationClasses.fadeOut),e.settings.effect.properties.fadingOut=!1,e.settings.effect.properties.ticker.stop()}),e.settings.effect.properties.viewHideContainer&&this.settings.effect.properties.$imageWrapper.addClass(this.settings.animationClasses.fadeIn).one("animationend",function(){this.style.opacity="1",n(this).removeClass(e.settings.animationClasses.fadeIn)}))},_timeoutDistortionTicker:function(){var e=this;setTimeout(function(){e._fadeOutDistortion()},this.settings.effect.properties.stopTimeout)},_initDistortionPixi:function(){void 0!==this.settings.effect.settings.appendTo&&""!==this.settings.effect.settings.appendTo&&this.settings.effect.settings.appendTo.appendChild(this.settings.effect.properties.renderer.view),this.settings.effect.properties.stage.addChild(this.settings.effect.properties.effectContainer),this.settings.effect.properties.renderer.view.style.width="100%",this.settings.effect.properties.renderer.view.style.height="100%",this.settings.effect.properties.renderer.view.style.objectFit="cover",this.settings.effect.properties.renderer.view.style.top="0",this.settings.effect.properties.renderer.view.style.left="0",this.settings.effect.properties.renderer.view.style.position="absolute",this.settings.effect.properties.renderer.view.style.display="block",this.settings.effect.properties.renderer.view.style.zIndex=this.settings.effect.properties.canvasZIndex,this.settings.effect.properties.renderer.autoResize=!0,this.settings.effect.properties.displacementSprite.texture.baseTexture.wrapMode=PIXI.WRAP_MODES.REPEAT,!(this.settings.effect.properties.stage.filters=[this.settings.effect.properties.displacementFilter])===this.settings.effect.settings.autoPlay&&(this.settings.effect.properties.displacementFilter.scale.x=0,this.settings.effect.properties.displacementFilter.scale.y=0),this.settings.effect.properties.displacementSprite.scale.x=2,this.settings.effect.properties.displacementSprite.scale.y=2,this.settings.effect.properties.displacementFilter.autoFit=this.settings.effect.settings.displaceAutoFit,this.settings.effect.properties.stage.addChild(this.settings.effect.properties.displacementSprite)},_loadPixiSprites:function(){for(var e=this.settings.effect.settings.sprites,g=this,t=new PIXI.loaders.Loader,i=0;i<e.length;i++)t.add(i.toString(),e[i]);t.load(function(e,t){for(var i in t){var s,r,n=new PIXI.Sprite(t[i].texture),f=t[i].texture.orig.width,i=t[i].texture.orig.height,o=g.settings.effect.properties.renderer.width,p=g.settings.effect.properties.renderer.height,a=i/f,c=p/o;switch("natural"===g.settings.effect.settings.spriteDimension?a<c?r=(s=o)*a:s=(r=p)/a:a<c?s=(r=p)/a:r=(s=o)*a,n.transform.scale.x=s/f,n.transform.scale.y=r/i,g.settings.effect.settings.spritePosition[0]){case"left":n.x=0;break;case"right":n.x=g.settings.effect.properties.renderer.width-s;break;default:n.x=(g.settings.effect.properties.renderer.width-s)/2}switch(g.settings.effect.settings.spritePosition[1]){case"top":n.y=0;break;case"bottom":n.y=g.settings.effect.properties.renderer.height-r;break;default:n.y=(g.settings.effect.properties.renderer.height-r)/2}g.settings.effect.properties.effectContainer.addChild(n)}})},_initDistortionEffect:function(){var t=this;this.settings.effect.properties.ticker=new PIXI.ticker.Ticker,this.settings.effect.properties.ticker.add(function(e){t.settings.effect.properties.displacementSprite.x+=t.settings.effect.settings.autoPlaySpeed[0]*e,t.settings.effect.properties.displacementSprite.y+=t.settings.effect.settings.autoPlaySpeed[1],t.settings.effect.properties.renderer.render(t.settings.effect.properties.stage)}),0===this.settings.effect.properties.startDelay?this._distortionStart():setTimeout(function(){t._distortionStart()},this.settings.effect.properties.startDelay)},_distortionStart:function(){this.isVisibile()?(this._fadeInDistortion(),this._timeoutDistortionTicker(),this.settings.effect.properties.launched=!0,this.settings.effect.properties.alreadyVisible=!0):this.settings.effect.properties.renderer.view.style.opacity="0"},_launchDistortion:function(){this._initDistortionPixi(),this._loadPixiSprites(),this._initDistortionEffect()},isVisibile:function(){var e=this.$window.height(),t=.8*e,e=.3*e,i=this.$element.offset().top,s=this.$element.height(),r=n(f).scrollTop();return i-t<r&&r<i+s-e},_viewport:function(){var e=f,t="inner";return"innerWidth"in f||(t="client",e=i.documentElement||i.body),{width:e[t+"Width"],height:e[t+"Height"]}}}),n.fn[r]=function(t){var i,s=arguments;return t===e||"object"==typeof t?this.each(function(){n.data(this,"plugin_"+r)||n.data(this,"plugin_"+r,new o(this,t))}):"string"==typeof t&&"_"!==t[0]&&"init"!==t?(this.each(function(){var e=n.data(this,"plugin_"+r);e instanceof o&&"function"==typeof e[t]&&(i=e[t].apply(e,Array.prototype.slice.call(s,1))),"destroy"===t&&n.data(this,"plugin_"+r,null)}),i!==e?i:this):void 0}}(jQuery,window,document);