/*
 *  rexEffect
 *  @version 1.0.0
 *
 *  Made by NEWEB - Digital Agency
 */
!function(e,t,i,s){"use strict";function r(i,s){this.element=i,this.$element=e(i),this.settings=e.extend({},f,s),this._defaults=f,this._name=n,this.$window=e(t),this.settings.animationClasses={fadeIn:"fadeIn",fadeOut:"fadeOut"},this.init()}var n="rexEffect",f={block_parent:".perfect-grid-item",effect:{name:"",options:{}}};e.extend(r.prototype,{init:function(){this.initEffect(),this.runEffect()},initEffect:function(){switch(this.settings.effect.name){case"distortion":var e=[],t=this.element.getElementsByClassName("grid-item-content")[0],i=t.getBoundingClientRect(),s=this.element.children[0];e.push(s.getAttribute("data-image_bg_block"));var r=s.getAttribute("data-block_flex_img_position").split(" "),n=s.getAttribute("data-type_bg_block");this.settings.effect.settings={stageWidth:i.width,stageHeight:i.height,sprites:e,spritePosition:r,spriteDimension:n,displacementImage:_plugin_frontend_settings.plugin_base_url+"public/img/clouds.jpg",autoPlay:!0,autoPlaySpeed:[10,3],displacementCenter:!0,displaceAutoFit:!1,appendTo:t},this.settings.effect.properties.viewHideContainer=!0,this.settings.effect.properties.$imageWrapper=this.$element.find(".rex-image-wrapper"),this.settings.effect.properties.alreadyVisible=!1,this.settings.effect.properties.launched=!1,this.settings.effect.properties.fadingIn=!1,this.settings.effect.properties.fadingOut=!1,this.settings.effect.properties.stopTimeout=3e3,this.settings.effect.properties.effectMode="scrollVisible",this.settings.effect.properties.canvasZIndex="-1";break;case"distortion-section":var e=[],t=this.element,i=t.getBoundingClientRect(),s=this.element.children[0];e.push(s.getAttribute("data-image_bg_section"));var r=["center","middle"],n=["full"];this.settings.effect.settings={stageWidth:i.width,stageHeight:i.height,sprites:e,spritePosition:r,spriteDimension:n,displacementImage:_plugin_frontend_settings.plugin_base_url+"public/img/clouds.jpg",autoPlay:!0,autoPlaySpeed:[10,3],displacementCenter:!0,displaceAutoFit:!1,appendTo:t},this.settings.effect.properties.viewHideContainer=!1,this.settings.effect.properties.$imageWrapper=this.$element,this.settings.effect.properties.alreadyVisible=!1,this.settings.effect.properties.launched=!1,this.settings.effect.properties.fadingIn=!1,this.settings.effect.properties.fadingOut=!1,this.settings.effect.properties.stopTimeout=3e3,this.settings.effect.properties.effectMode="scrollVisible",this.settings.effect.properties.canvasZIndex="0"}},runEffect:function(){switch(this.settings.effect.name){case"distortion":this.distortion();break;case"distortion-section":this.distortion()}},distortion:function(){var e=this;switch(this.settings.effect.properties.renderer=new PIXI.autoDetectRenderer(this.settings.effect.settings.stageWidth,this.settings.effect.settings.stageHeight,{transparent:!0}),this.settings.effect.properties.stage=new PIXI.Container,this.settings.effect.properties.effectContainer=new PIXI.Container,this.settings.effect.properties.displacementSprite=new PIXI.Sprite.fromImage(this.settings.effect.settings.displacementImage),this.settings.effect.properties.displacementFilter=new PIXI.filters.DisplacementFilter(this.settings.effect.properties.displacementSprite),this.settings.effect.settings.displacementCenter===!0&&(this.settings.effect.properties.displacementSprite.anchor.set(.5),this.settings.effect.properties.displacementSprite.x=this.settings.effect.properties.renderer.view.width/2,this.settings.effect.properties.displacementSprite.y=this.settings.effect.properties.renderer.view.height/2),this._launchDistortion(),t.addEventListener("resize",function(){e.settings.effect.properties.hasResized=!0}),t.addEventListener("scroll",function(){e.settings.effect.properties.hasScrolled=!0}),setInterval(function(){if(e.settings.effect.properties.hasResized){var t=e.settings.effect.settings.appendTo.getBoundingClientRect();e.settings.effect.properties.renderer.resize(t.width,t.height);var i=e.settings.effect.properties.effectContainer.getChildAt(0),s=i.texture.orig.width,r=i.texture.orig.height,n=e.settings.effect.properties.renderer.width,f=e.settings.effect.properties.renderer.height,o=r/s,p=f/n;switch(e.settings.effect.settings.spriteDimension){case"natural":if(p>o)var a=n,c=n*o;else var c=f,a=f/o;break;case"full":default:if(p>o)var c=f,a=f/o;else var a=n,c=n*o}switch(i.transform.scale.x=a/s,i.transform.scale.y=c/r,e.settings.effect.settings.spritePosition[0]){case"left":i.x=0;break;case"right":i.x=e.settings.effect.properties.renderer.width-a;break;case"center":default:i.x=(e.settings.effect.properties.renderer.width-a)/2}switch(e.settings.effect.settings.spritePosition[1]){case"top":i.y=0;break;case"bottom":i.y=e.settings.effect.properties.renderer.height-c;break;case"middle":default:i.y=(e.settings.effect.properties.renderer.height-c)/2}e.settings.effect.properties.hasResized=!1}},250),this.settings.effect.properties.effectMode){case"oneTime":setInterval(function(){e.settings.effect.properties.hasScrolled&&!e.settings.effect.properties.launched&&(e.isVisibile()?e.settings.effect.properties.ticker.started||(e._fadeInDistortion(),e._timeoutDistortionTicker(),e.settings.effect.properties.launched=!0,e.settings.effect.properties.alreadyVisible=!0):(e.settings.effect.properties.ticker.started&&e._fadeOutDistortion(),e.settings.effect.properties.alreadyVisible=!1)),e.settings.effect.properties.hasScrolled=!1},250);break;case"scrollAll":setInterval(function(){e.settings.effect.properties.hasScrolled&&(e.isVisibile()?e.settings.effect.properties.ticker.started||(e._fadeInDistortion(),e._timeoutDistortionTicker(),e.settings.effect.properties.launched=!0,e.settings.effect.properties.alreadyVisible=!0):(e.settings.effect.properties.ticker.started&&e._fadeOutDistortion(),e.settings.effect.properties.alreadyVisible=!1)),e.settings.effect.properties.hasScrolled=!1},250);break;case"scrollVisible":setInterval(function(){e.settings.effect.properties.hasScrolled&&(e.isVisibile()?e.settings.effect.properties.ticker.started||e.settings.effect.properties.alreadyVisible||(e._fadeInDistortion(),e._timeoutDistortionTicker(),e.settings.effect.properties.launched=!0,e.settings.effect.properties.alreadyVisible=!0):(e.settings.effect.properties.ticker.started&&e._fadeOutDistortion(),e.settings.effect.properties.alreadyVisible=!1)),e.settings.effect.properties.hasScrolled=!1},250)}},_simpleFadeIn:function(){that.settings.effect.properties.ticker.start(),that.settings.effect.properties.renderer.view.style.opacity="1",that.settings.effect.properties.$imageWrapper[0].style.opacity="0"},_simpleFadeOut:function(){that.settings.effect.properties.ticker.stop(),that.settings.effect.properties.renderer.view.style.opacity="0",that.settings.effect.properties.$imageWrapper[0].style.opacity="1"},_fadeInDistortion:function(){if(!this.settings.effect.properties.fadingIn){var t=this;this.settings.effect.properties.fadingIn=!0,this.settings.effect.properties.ticker.start(),e(this.settings.effect.properties.renderer.view).addClass(this.settings.animationClasses.fadeIn).one("animationend",function(){t.settings.effect.properties.viewHideContainer&&(this.style.opacity="1"),e(this).removeClass(t.settings.animationClasses.fadeIn),t.settings.effect.properties.fadingIn=!1}),t.settings.effect.properties.viewHideContainer&&this.settings.effect.properties.$imageWrapper.addClass(this.settings.animationClasses.fadeOut).one("animationend",function(){this.style.opacity="0",e(this).removeClass(t.settings.animationClasses.fadeOut)})}},_fadeOutDistortion:function(){if(!this.settings.effect.properties.fadingOut){this.settings.effect.properties.fadingOut=!0;var t=this;e(this.settings.effect.properties.renderer.view).addClass(this.settings.animationClasses.fadeOut).one("animationend",function(){t.settings.effect.properties.viewHideContainer&&(this.style.opacity="0"),e(this).removeClass(t.settings.animationClasses.fadeOut),t.settings.effect.properties.fadingOut=!1,t.settings.effect.properties.ticker.stop()}),t.settings.effect.properties.viewHideContainer&&this.settings.effect.properties.$imageWrapper.addClass(this.settings.animationClasses.fadeIn).one("animationend",function(){this.style.opacity="1",e(this).removeClass(t.settings.animationClasses.fadeIn)})}},_timeoutDistortionTicker:function(){var e=this;setTimeout(function(){e._fadeOutDistortion()},this.settings.effect.properties.stopTimeout)},_initDistortionPixi:function(){"undefined"!=typeof this.settings.effect.settings.appendTo&&""!==this.settings.effect.settings.appendTo&&this.settings.effect.settings.appendTo.appendChild(this.settings.effect.properties.renderer.view),this.settings.effect.properties.stage.addChild(this.settings.effect.properties.effectContainer),this.settings.effect.properties.renderer.view.style.width="100%",this.settings.effect.properties.renderer.view.style.height="100%",this.settings.effect.properties.renderer.view.style.objectFit="cover",this.settings.effect.properties.renderer.view.style.top="0",this.settings.effect.properties.renderer.view.style.left="0",this.settings.effect.properties.renderer.view.style.position="absolute",this.settings.effect.properties.renderer.view.style.display="block",this.settings.effect.properties.renderer.view.style.zIndex=this.settings.effect.properties.canvasZIndex,this.settings.effect.properties.renderer.autoResize=!0,this.settings.effect.properties.displacementSprite.texture.baseTexture.wrapMode=PIXI.WRAP_MODES.REPEAT,this.settings.effect.properties.stage.filters=[this.settings.effect.properties.displacementFilter],this.settings.effect.settings.autoPlay===!1&&(this.settings.effect.properties.displacementFilter.scale.x=0,this.settings.effect.properties.displacementFilter.scale.y=0),this.settings.effect.properties.displacementSprite.scale.x=2,this.settings.effect.properties.displacementSprite.scale.y=2,this.settings.effect.properties.displacementFilter.autoFit=this.settings.effect.settings.displaceAutoFit,this.settings.effect.properties.stage.addChild(this.settings.effect.properties.displacementSprite)},_loadPixiSprites:function(){for(var e=this.settings.effect.settings.sprites,t=this,i=new PIXI.loaders.Loader,s=0;s<e.length;s++)i.add(s.toString(),e[s]);i.load(function(e,i){for(var s in i){var r=new PIXI.Sprite(i[s].texture),n=i[s].texture.orig.width,f=i[s].texture.orig.height,o=t.settings.effect.properties.renderer.width,p=t.settings.effect.properties.renderer.height,a=f/n,c=p/o;switch(t.settings.effect.settings.spriteDimension){case"natural":if(c>a)var g=o,d=o*a;else var d=p,g=p/a;break;case"full":default:if(c>a)var d=p,g=p/a;else var g=o,d=o*a}switch(r.transform.scale.x=g/n,r.transform.scale.y=d/f,t.settings.effect.settings.spritePosition[0]){case"left":r.x=0;break;case"right":r.x=t.settings.effect.properties.renderer.width-g;break;case"center":default:r.x=(t.settings.effect.properties.renderer.width-g)/2}switch(t.settings.effect.settings.spritePosition[1]){case"top":r.y=0;break;case"bottom":r.y=t.settings.effect.properties.renderer.height-d;break;case"middle":default:r.y=(t.settings.effect.properties.renderer.height-d)/2}t.settings.effect.properties.effectContainer.addChild(r)}})},_initDistortionEffect:function(){var e=this;this.settings.effect.properties.ticker=new PIXI.ticker.Ticker,this.settings.effect.properties.ticker.add(function(t){e.settings.effect.properties.displacementSprite.x+=e.settings.effect.settings.autoPlaySpeed[0]*t,e.settings.effect.properties.displacementSprite.y+=e.settings.effect.settings.autoPlaySpeed[1],e.settings.effect.properties.renderer.render(e.settings.effect.properties.stage)}),0===this.settings.effect.properties.startDelay?this._distortionStart():setTimeout(function(){e._distortionStart()},this.settings.effect.properties.startDelay)},_distortionStart:function(){this.isVisibile()?(this._fadeInDistortion(),this._timeoutDistortionTicker(),this.settings.effect.properties.launched=!0,this.settings.effect.properties.alreadyVisible=!0):this.settings.effect.properties.renderer.view.style.opacity="0"},_launchDistortion:function(){this._initDistortionPixi(),this._loadPixiSprites(),this._initDistortionEffect()},isVisibile:function(){var i,s,r=this.$window.height();i=.8*r,s=.3*r;var n=this.$element.offset().top,f=this.$element.height(),o=e(t).scrollTop();return n-i<o&&n+f-s>o},_viewport:function(){var e=t,s="inner";return"innerWidth"in t||(s="client",e=i.documentElement||i.body),{width:e[s+"Width"],height:e[s+"Height"]}}}),e.fn[n]=function(t){var i=arguments;if(t===s||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new r(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var f;return this.each(function(){var s=e.data(this,"plugin_"+n);s instanceof r&&"function"==typeof s[t]&&(f=s[t].apply(s,Array.prototype.slice.call(i,1))),"destroy"===t&&e.data(this,"plugin_"+n,null)}),f!==s?f:this}}}(jQuery,window,document);